!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.ApiClient=e()}}(function(){return function e(t,o,r){function n(a,s){if(!o[a]){if(!t[a]){var c="function"==typeof require&&require;if(!s&&c)return c(a,!0);if(i)return i(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=o[a]={exports:{}};t[a][0].call(u.exports,function(e){var o=t[a][1][e];return n(o?o:e)},u,u.exports,e,t,o,r)}return o[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)n(r[a]);return n}({1:[function(e,t){"use strict";function o(e){for(;e.parentResource;)e.identity="",e=e.parentResource}function r(e,t,o){var r=function n(e){return e&&!i.isString(e)&&console.error("identity должен быть строкой, а не",e),n.identity=e||"",n};return $.extend(r,a,{resourceName:e,url:e},o),r.parentResource=t,r.instance=t.instance||t,r}function n(e,t){return this instanceof n?(i.isObject(e)&&(t=e,e=location.origin),null==e&&(e=location.origin),t=t||{},t.url=e,this.notifications=!1,this.hooks={data:{},headers:{}},void $.extend(!0,this,t)):new n(e,t)}var i=e("./utils"),a={resourceName:"resource",url:"",add:function(e,t,o){if(o||(o=t||{},t=this),this[e])throw new TypeError("The resource named "+e+"already exists.");if((o.schemaName||o.collectionName||o.storage)&&(o.collectionName=o.collectionName||e),this[e]=new r(e,t,o),o.collectionName&&!storage[o.collectionName]){var n=storage.schemas[o.schemaName];if(!n)throw new TypeError("Resource::"+e+" You cannot use storage (create collection), without specifying the schema of the data.");storage.createCollection(o.collectionName,n,this[e])}return this[e]},constructUrl:function u(){var e=this.identity?"/"+this.identity:"";return this.parentResource?u.call(this.parentResource,!0)+"/"+this.url+e:this.url},_resourceRequest:function(e,t,o){var r=this.constructUrl(),n=this.notifications;return console.log(this.resourceName+"::"+e+" "+r),this.instance._request(e,r,t.data,t,n,o)}},s=[],c={create:"POST",read:"GET",update:"PUT","delete":"DELETE",patch:"PATCH",post:"POST",get:"GET",save:"PUT"};Object.keys(c).forEach(function(e){a[e]=function(t,r,n){var a,c=this,u=this.identity,l=this.instance.methodsMap[e];$.isFunction(t)&&(n=t,t=void 0),$.isFunction(r)&&(n=r,r=void 0),r=r||{},("POST"===l||"PUT"===l)&&(t instanceof storage.Document?(a=t._id.toString(),t=t.$__delta()):storage.ObjectId.isValid(u)?a=u:t._id&&storage.ObjectId.isValid(t._id)&&(a=t._id.toString())),r.data=t;var f={method:l,url:this.constructUrl(),ajaxSettings:r,result:null,meta:null};if("GET"===l){var d=_.find(s,f);if(c.storage&&u&&d&&d.result)return n&&n(d.result,d.meta),void o(c)}var h=$.Deferred();return this._resourceRequest(e,r).done(function(e,o,u){var d,p;t&&t.fields&&(p=i.select(t.fields)),c.storage&&!r.doNotStore?"POST"===l||"PUT"===l?(d=storage[c.collectionName].findById(a),d?(d.set(e.result),storage[c.collectionName].updateIdLink(d),d.isNew=!1):d=storage[c.collectionName].add(e.result||e,void 0,!0)):"GET"===l&&(d=p?e.result:storage[c.collectionName].add(e.result||e,p,!0)):d=e.result||e,f.result=d,f.meta=e.meta,s.push(f),n&&n(d,e.meta),h.resolve(d,e.meta,o,u)}).fail(function(e,t,o){h.reject(e,t,o)}),o(c),h}}),n.prototype={add:a.add,methodsMap:c,_prepareAjaxSettings:function(e,t,o,r){var n=this.methodsMap[e],a=i.deepMerge(this.hooks,r);return a.type=n,a.url=t,this.token&&r.headers&&null==r.headers.token&&(a.headers.Authorization="token "+this.token),"GET"===n?a.data=i.deepMerge(a.data,o):(o&&o.constructor&&o.constructor.name&&"Document"===o.constructor.name?a.data=i.deepMerge(a.data,o.toObject({depopulate:1})):o&&(a.data=i.deepMerge(a.data,o)),a.data&&"application/json"===a.contentType&&(a.data=JSON.stringify(a.data))),$.isPlainObject(t)&&(console.info("Ах@*ть, нужный код!!!!"),a=t),a},_request:function(e,t,o,r,n,a){if(!i.isString(e))throw new Error("Параметр `method` должен быть строкой, а не ",e);var s=this,c=this.methodsMap[e],u="GET"===c?"load":"POST"===c||"PUT"===c||"PATCH"===c?"save":"delete",l=this._prepareAjaxSettings(e,t,o,r);return n=i.isBoolean(n)?n&&cf.notification:this.notifications&&cf.notification,n&&cf.notification[u].show(),$.ajax(l).fail(function(i,c,l){return console.warn(i,c,l),401===i.status&&s.unauthorizedCallback?(s.unauthorizedCallback(i,e,t,o,r,a),void(n&&cf.notification[u].hide())):void(n&&cf.notification[u].fail())}).done(function(){n&&cf.notification[u].hide()}).done(a)}},n.prototype.get=function(e,t){return console.log("api::get"),$.isFunction(e)&&(t=e,e=void 0),e=e||{},this._request("read",this.url,void 0,e,!1,t)},n.prototype.read=n.prototype.get,n.version="0.2.0",n.utils=i,t.exports=n},{"./utils":2}],2:[function(e,t){"use strict";function o(e){return e&&"object"==typeof e||!1}var r={},n="[object Boolean]",i="[object String]",a=(Array.prototype,Object.prototype),s=a.toString;r.isString=function(e){return"string"==typeof e||o(e)&&s.call(e)===i||!1},r.isBoolean=function(e){return e===!0||e===!1||o(e)&&s.call(e)===n||!1},r.isObject=function(e){var t=typeof e;return"function"===t||e&&"object"===t||!1},r.deepMerge=function c(e,t){var o=Array.isArray(t),r=o&&[]||{};if(o)e=e||[],r=r.concat(e),t.forEach(function(t,o){"undefined"==typeof r[o]?r[o]=t:"object"==typeof t?r[o]=c(e[o],t):-1===e.indexOf(t)&&r.push(t)});else{if(e&&"object"==typeof e&&Object.keys(e).forEach(function(t){r[t]=e[t]}),null==t)return r;Object.keys(t).forEach(function(o){r[o]="object"==typeof t[o]&&t[o]&&e[o]?c(e[o],t[o]):t[o]})}return r},r.select=function(e){if(e){if(1!==arguments.length)throw new Error("Invalid select: select only takes 1 argument");var t={},o=typeof e;if("string"===o||"object"===o&&"number"==typeof e.length&&!Array.isArray(e)){"string"===o&&(e=e.split(/\s+/));for(var r=0,n=e.length;n>r;++r){var i=e[r];if(i){var a="-"===i[0]?0:1;0===a&&(i=i.substring(1)),t[i]=a}}return t}if(_.isPlainObject(e)&&!Array.isArray(e)){for(var s=Object.keys(e),c=0;c<s.length;++c)t[s[c]]=e[s[c]];return t}throw new TypeError("Invalid select() argument. Must be string or object.")}},t.exports=r},{}]},{},[1])(1)});