!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.ApiClient=t()}}(function(){return function t(e,i,o){function r(s,a){if(!i[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(n)return n(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){var i=e[s][1][t];return r(i?i:t)},u,u.exports,t,e,i,o)}return i[s].exports}for(var n="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r}({1:[function(t,e){"use strict";function i(t){for(;t.parentResource;)t.identity="",t=t.parentResource}function o(t,e,i){var o=function r(t){return t&&!_.isString(t)&&console.error("identity должен быть строкой, а не",t),r.identity=t||"",r};return $.extend(o,s,{resourceName:t,url:t},i),o.parentResource=e,o.instance=e.instance||e,o}function r(t,e){return this instanceof r?(_.isObject(t)&&(e=t,t=location.origin),null==t&&(t=location.origin),e=e||{},e.url=t,this.notifications=!1,this.hooks={data:{},headers:{}},void $.extend(!0,this,e)):new r(t,e)}var n=t("./utils"),s={resourceName:"resource",url:"",add:function(t,e,i){if(i||(i=e||{},e=this),this[t])throw new TypeError("The resource named "+t+"already exists.");if((i.schemaName||i.collectionName||i.storage)&&(i.collectionName=i.collectionName||t),this[t]=new o(t,e,i),i.collectionName&&!storage[i.collectionName]){var r=storage.schemas[i.schemaName];if(!r)throw new TypeError("Resource::"+t+" You cannot use storage (create collection), without specifying the schema of the data.");storage.createCollection(i.collectionName,r,this[t])}return this[t]},constructUrl:function u(){var t=this.identity?"/"+this.identity:"";return this.parentResource?u.call(this.parentResource,!0)+"/"+this.url+t:this.url},_resourceRequest:function(t,e,i){var o=this.constructUrl(),r=this.notifications;return console.log(this.resourceName+"::"+t+" "+o),this.instance._request(t,o,e.data,e,r,i)}},a=[],c={create:"POST",read:"GET",update:"PUT","delete":"DELETE",patch:"PATCH",post:"POST",get:"GET",save:"PUT"};_.forEach(Object.keys(c),function(t){s[t]=function(e,o,r){var s,c=this,u=this.identity,l=this.instance.methodsMap[t];$.isFunction(e)&&(r=e,e=void 0),$.isFunction(o)&&(r=o,o=void 0),o=o||{},("POST"===l||"PUT"===l)&&(e instanceof storage.Document?(s=e._id.toString(),e=e.$__delta()):storage.ObjectId.isValid(u)?s=u:e._id&&storage.ObjectId.isValid(e._id)&&(s=e._id.toString())),o.data=e;var d={method:l,url:this.constructUrl(),ajaxSettings:o,result:null,meta:null};if("GET"===l){var f=_.find(a,d);if(c.storage&&u&&f&&f.result)return r&&r(f.result,f.meta),void i(c)}var h=$.Deferred();return this._resourceRequest(t,o).done(function(t,i,u){var f,p;e&&e.fields&&(p=n.select(e.fields)),c.storage&&!o.doNotStore?"POST"===l||"PUT"===l?(f=storage[c.collectionName].findById(s),f?(f.set(t.result),storage[c.collectionName].updateIdLink(f),f.isNew=!1):f=storage[c.collectionName].add(t.result||t,void 0,!0)):"GET"===l&&(f=p?t.result:storage[c.collectionName].add(t.result||t,p,!0)):f=t.result||t,d.result=f,d.meta=t.meta,a.push(d),r&&r(f,t.meta),h.resolve(f,t.meta,i,u)}).fail(function(t,e,i){h.reject(t,e,i)}),i(c),h}}),r.prototype={add:s.add,methodsMap:c,_prepareAjaxSettings:function(t,e,i,o){var r=this.methodsMap[t],n=$.extend(!0,{},this.hooks,o,{type:r,url:e});return this.token&&o.headers&&null==o.headers.token&&(n.headers.Authorization="token "+this.token),"GET"===r?_.assign(n.data,i):(i&&i.constructor&&i.constructor.name&&"Document"===i.constructor.name?_.assign(n.data,i.toObject({depopulate:1})):i&&_.assign(n.data,i),n.data&&"application/json"===n.contentType&&(n.data=JSON.stringify(n.data))),$.isPlainObject(e)&&(console.info("Ах@*ть, нужный код!!!!"),n=e),n},_request:function(t,e,i,o,r,n){if(!_.isString(t))throw new Error("Параметр `method` должен быть строкой, а не ",t);var s=this,a=this.methodsMap[t],c="GET"===a?"load":"POST"===a||"PUT"===a||"PATCH"===a?"save":"delete",u=this._prepareAjaxSettings(t,e,i,o);return r=_.isBoolean(r)?r&&cf.notification:this.notifications&&cf.notification,r&&cf.notification[c].show(),$.ajax(u).fail(function(a,u,l){return console.warn(a,u,l),401===a.status&&s.unauthorizedCallback?(s.unauthorizedCallback(a,t,e,i,o,n),void(r&&cf.notification[c].hide())):void(r&&cf.notification[c].fail())}).done(function(){r&&cf.notification[c].hide()}).done(n)}},r.prototype.get=function(t,e){return console.log("api::get"),$.isFunction(t)&&(e=t,t=void 0),t=t||{},this._request("read",this.url,void 0,t,!1,e)},r.prototype.read=r.prototype.get,r.version="0.2.0",r.utils=n,e.exports=r},{"./utils":2}],2:[function(t,e){"use strict";var i={};i.select=function(t){if(t){if(1!==arguments.length)throw new Error("Invalid select: select only takes 1 argument");var e={},i=typeof t;if("string"===i||"object"===i&&"number"==typeof t.length&&!Array.isArray(t)){"string"===i&&(t=t.split(/\s+/));for(var o=0,r=t.length;r>o;++o){var n=t[o];if(n){var s="-"===n[0]?0:1;0===s&&(n=n.substring(1)),e[n]=s}}return e}if(_.isPlainObject(t)&&!Array.isArray(t)){for(var a=Object.keys(t),c=0;c<a.length;++c)e[a[c]]=t[a[c]];return e}throw new TypeError("Invalid select() argument. Must be string or object.")}},e.exports=i},{}]},{},[1])(1)});