!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.ApiClient=t()}}(function(){return function t(e,n,i){function r(s,a){if(!n[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=n[s]={exports:{}};e[s][0].call(u.exports,function(t){var n=e[s][1][t];return r(n?n:t)},u,u.exports,t,e,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e){"use strict";function n(t){for(;t.parentResource;)t.identity="",t=t.parentResource}var i={resourceName:"resource",url:"",add:function(t,e,n){if(n||(n=e||{},e=this),this[t])throw new TypeError("Ресурс с названием "+t+"уже есть.");if((n.schemaName||n.collectionName||n.storage)&&(n.collectionName=n.collectionName||t),this[t]=new s(t,e,n),n.collectionName&&!storage[n.collectionName]){var i=storage.schemas[n.schemaName];if(!i)throw new TypeError("Resource::"+t+" Нельзя использовать хранилище (создать коллекцию), не указав схему данных");storage.createCollection(n.collectionName,i,this[t])}return this[t]},transformFields:function(){var t=arguments[0];if(!t)return this;if(1!==arguments.length)throw new Error("Invalid select: select only takes 1 argument");var e=this._fields||(this._fields={}),n=typeof t;if("string"==n||"object"==n&&"number"==typeof t.length&&!Array.isArray(t)){"string"==n&&(t=t.split(/\s+/));for(var i=0,r=t.length;r>i;++i){var o=t[i];if(o){var s="-"==o[0]?0:1;0===s&&(o=o.substring(1)),e[o]=s}}return this}if(_.isObject(t)&&!Array.isArray(t)){for(var a=Object.keys(t),i=0;i<a.length;++i)e[a[i]]=t[a[i]];return this}throw new TypeError("Invalid select() argument. Must be string or object.")},constructUrl:function c(){var t=this.identity?"/"+this.identity:"";return this.parentResource?c.call(this.parentResource,!0)+"/"+this.url+t:this.url},_resourceRequest:function(t,e,n){var i=this.constructUrl(),r=this.notifications;return console.log(this.resourceName+"::"+t+" "+i),this.instance._request(t,i,e.data,e,r,n)}},r=[],o={create:"POST",read:"GET",update:"PUT","delete":"DELETE",patch:"PATCH",post:"POST",get:"GET",save:"PUT"};_.forEach(Object.keys(o),function(t){i[t]=function(e,i,o){var s,a=this,c=this.identity,u=this.instance.methodsMap[t];$.isFunction(e)&&(o=e,e=void 0),$.isFunction(i)&&(o=i,i=void 0),i=i||{},("POST"===u||"PUT"===u)&&(e instanceof storage.Document?(s=e._id.toString(),e=e.$__delta()):storage.ObjectId.isValid(c)?s=c:e._id&&storage.ObjectId.isValid(e._id)&&(s=e._id.toString())),i.data=e;var l={method:u,url:this.constructUrl(),ajaxSettings:i,result:null,meta:null};if("GET"===u){var d=_.find(r,l);if(a.storage&&c&&d&&d.result)return o&&o(d.result,d.meta),void n(a)}var f=$.Deferred();return this._resourceRequest(t,i).done(function(t,n,c){var d,h;e&&e.fields&&(h=a.transformFields(e.fields)),a.storage&&!i.doNotStore?"POST"===u||"PUT"===u?(d=storage[a.collectionName].findById(s),d?(d.set(t.result),storage[a.collectionName].updateIdLink(d),d.isNew=!1):d=storage[a.collectionName].add(t.result||t,void 0,!0)):"GET"===u&&(d=h?t.result:storage[a.collectionName].add(t.result||t,h,!0)):d=t.result||t,l.result=d,l.meta=t.meta,r.push(l),o&&o(d,t.meta),f.resolve(d,t.meta,n,c)}).fail(function(t,e,n){f.reject(t,e,n)}),n(a),f}});var s=function(t,e,n){var r=function o(t){return t&&!_.isString(t)&&console.error("identity должен быть строкой, а не",t),o.identity=t||"",o};return $.extend(r,i,{resourceName:t,url:t},n),r.parentResource=e,r.instance=e.instance||e,r},a=function(t,e){return new a.instance.init(t,e)};a.instance=a.prototype={constructor:a,init:function(t,e){"string"==typeof t&&(e=e||{},e.url=t),this.notifications=!1,this.hooks={data:{},headers:{}},$.extend(!0,this,$.isPlainObject(t)?t:e)},add:i.add,methodsMap:o,_prepareAjaxSettings:function(t,e,n,i){var r=this.methodsMap[t],o=$.extend(!0,{},this.hooks,i,{type:r,url:e});return this.token&&i.headers&&null==i.headers.token&&(o.headers.Authorization="token "+this.token),"GET"===r?_.assign(o.data,n):(n&&n.constructor&&n.constructor.name&&"Document"===n.constructor.name?_.assign(o.data,n.toObject({depopulate:1})):n&&_.assign(o.data,n),o.data&&"application/json"===o.contentType&&(o.data=JSON.stringify(o.data))),$.isPlainObject(e)&&(console.info("Ах@*ть, нужный код!!!!"),o=e),o},_request:function(t,e,n,i,r,o){if(!_.isString(t))throw new Error("Параметр `method` должен быть строкой, а не ",t);var s=this,a=this.methodsMap[t],c="GET"===a?"load":"POST"===a||"PUT"===a||"PATCH"===a?"save":"delete",u=this._prepareAjaxSettings(t,e,n,i);return r=_.isBoolean(r)?r&&cf.notification:this.notifications&&cf.notification,r&&cf.notification[c].show(),$.ajax(u).fail(function(a,u,l){return console.warn(a,u,l),401===a.status&&s.unauthorizedCallback?(s.unauthorizedCallback(a,t,e,n,i,o),void(r&&cf.notification[c].hide())):void(r&&cf.notification[c].fail())}).done(function(){r&&cf.notification[c].hide()}).done(o)},read:function(t,e){return console.log("api::read"),$.isFunction(t)&&(e=t,t=void 0),t=t||{},this._request("read",this.url,void 0,t,!1,e)}},a.instance.init.prototype=a.instance,e.exports=a},{}]},{},[1])(1)});