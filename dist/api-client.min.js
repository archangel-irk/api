!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.ApiClient=t()}}(function(){return function n(i,a,s){function c(o,t){if(!a[o]){if(!i[o]){var e="function"==typeof require&&require;if(!t&&e)return e(o,!0);if(u)return u(o,!0);throw new Error("Cannot find module '"+o+"'")}var r=a[o]={exports:{}};i[o][0].call(r.exports,function(t){var e=i[o][1][t];return c(e||t)},r,r.exports,n,i,a,s)}return a[o].exports}for(var u="function"==typeof require&&require,t=0;t<s.length;t++)c(s[t]);return c}({1:[function(t,e,o){"use strict";var i=t("./utils");function r(){this.data={}}r.prototype.getKey=function(o){var r="",n=this;return Object.keys(o).forEach(function(t){var e=o[t];r+=t+"="+(i.isObject(e)?"{"+n.getKey(e)+"}":e)+"|"}),r},r.prototype.put=function(t,e){this.data[t]={created:new Date,data:e}},r.prototype.get=function(t){var e;if(e=this.data[t])return e.data.response.__cached=!0,e.data},r.prototype.clear=function(){this.data={}},e.exports=r},{"./utils":6}],2:[function(t,e,o){"use strict";var i=t("./utils");e.exports=function(t,e,r){i.isFunction(t)&&(r=t,t=void 0),i.isFunction(e)&&(r=e,e=void 0),(e=e||{}).data=t;var n=$.Deferred();return this._resourceRequest("DELETE",e).done(function(t,e,o){r&&r(t,e,o),n.resolve(t,e,o)}).fail(function(t,e,o){n.reject(t,e,o)}),i.clearIdentity(this),n}},{"./utils":6}],3:[function(t,e,o){"use strict";var l=t("./utils"),r=t("./get"),n=t("./post").createPostLikeRequest,i=t("./delete"),a=t("./cache"),s={resourceName:"resource",url:"",add:function(t,e,o){if(o||(o=e||{},e=this),this[t])throw new TypeError("The resource named "+t+"already exists.");if((o.schemaName||o.collectionName||o.storage)&&(o.collectionName=o.collectionName||t),this[t]=new c(t,e,o),o.collectionName&&!storage[o.collectionName]){var r=storage.schemas[o.schemaName];if(!r)throw new TypeError("Resource::"+t+" You cannot use storage (create collection), without specifying the schema of the data.");storage.createCollection(o.collectionName,r,this[t])}return this[t]},_resourceRequest:function(t,e,o){var r=l.constructUrl(this),n=this.notifications;return this.apiRoot._request(t,r,e.data,e,n,o)}};function c(t,e,o){function r(t){return null==t||(t&&!l.isString(t)&&console.error("identity должен быть строкой, а не",t),r.identity=t||""),r}return $.extend(r,s,{resourceName:t,url:t},o),r.parentResource=e,r.apiRoot=e.apiRoot||e,r}function u(t,e){if(!(this instanceof u))return new u(t,e);this.defaults={stripTrailingSlashes:!0,cache:!0},l.isObject(t)&&(e=t,t=location.origin),null==t&&(t=location.origin),(e=e||{}).url=t,this.notifications=!1,this.hooks={data:{},headers:{}},$.extend(!0,this,e),this.defaults.cache&&(this.cache=new a)}s.get=r,s.read=r,s.post=n("POST"),s.create=s.post,s.put=n("PUT"),s.update=s.put,s.save=s.put,s.patch=n("PATCH"),s.delete=i,(u.prototype={add:s.add,_methods:{create:"POST",read:"GET",update:"PUT",delete:"DELETE",patch:"PATCH",post:"POST",get:"GET",save:"PUT"},_prepareAjaxSettings:function(t,e,o,r){var n=l.deepMerge(this.hooks,r);return n.type=t,this.defaults.stripTrailingSlashes&&(e=e.replace(/\/+$/,"")||"/"),n.url=e,this.token&&r.headers&&null==r.headers.token&&(n.headers.Authorization="token "+this.token),"GET"===t?n.data=l.deepMerge(n.data,o):(o&&o.constructor&&o.constructor.name&&"Document"===o.constructor.name?n.data=l.deepMerge(n.data,o.toObject({depopulate:1})):o&&(n.data=l.deepMerge(n.data,o)),n.data&&"application/json"===n.contentType&&(n.data=JSON.stringify(n.data))),l.isObject(e)&&(console.info("Ах@*ть, нужный код!!!!"),n=e),n},_request:function(r,n,i,a,s,c){if(!l.isString(r))throw new Error("Параметр `method` должен быть строкой, а не ",r);var u=this,f="GET"===r?"load":"POST"===r||"PUT"===r||"PATCH"===r?"save":"delete",t=this._prepareAjaxSettings(r,n,i,a);return(s=l.isBoolean(s)?s&&cf.notification:this.notifications&&cf.notification)&&cf.notification[f].show(),console.log(r+" "+t.url),$.ajax(t).fail(function(t,e,o){if(console.warn(t,e,o),401===t.status&&u.unauthorizedCallback)return u.unauthorizedCallback(t,r,n,i,a,c),void(s&&cf.notification[f].hide());s&&cf.notification[f].fail()}).done(function(){s&&cf.notification[f].hide()}).done(c)}}).read=u.prototype.get=function(t,e){return console.log("api::get"),l.isFunction(t)&&(e=t,t=void 0),t=t||{},this._request("GET",this.url,void 0,t,!1,e)},u.version="0.3.0",u.utils=l,e.exports=u},{"./cache":1,"./delete":2,"./get":4,"./post":5,"./utils":6}],4:[function(t,e,o){"use strict";var f=t("./utils");e.exports=function(n,i,a){var s,c=this;if(f.isFunction(n)&&(a=n,n=void 0),f.isFunction(i)&&(a=i,i=void 0),(i=i||{}).data=n,c.apiRoot.defaults.cache){i.url=f.constructUrl(c),s=c.apiRoot.cache.getKey(i);var t=c.apiRoot.cache.get(s);if(t)return a&&a(t.response,t.textStatus,t.jqXHR),f.clearIdentity(c),$.Deferred().resolve(t.response,t.textStatus,t.jqXHR)}var u=$.Deferred();return this._resourceRequest("GET",i).done(function(t,e,o){var r;n&&n.fields&&(r=f.select(n.fields)),c.storage&&!i.doNotStore&&(t=storage[c.collectionName].add(t,r,!0)),c.apiRoot.defaults.cache&&c.apiRoot.cache.put(s,{response:t,textStatus:e,jqXHR:o}),a&&a(t,e,o),u.resolve(t,e,o)}).fail(function(t,e,o){u.reject(t,e,o)}),f.clearIdentity(c),u}},{"./utils":6}],5:[function(t,e,o){"use strict";var r=t("./utils");function n(t,e,n,i){var a,s=this,o=this.identity;r.isFunction(e)&&(i=e,e=void 0),r.isFunction(n)&&(i=n,n=void 0),n=n||{},s.storage&&e instanceof storage.Document?(a=e._id.toString(),e=e.$__delta()):s.storage&&storage.ObjectId.isValid(o)?a=o:s.storage&&e._id&&storage.ObjectId.isValid(e._id)&&(a=e._id.toString()),n.data=e;var c=$.Deferred();return this._resourceRequest(t,n).done(function(t,e,o){var r;s.storage&&!n.doNotStore&&(t=(r=storage[s.collectionName].findById(a))?(r.set(t),storage[s.collectionName].updateIdLink(r),r.isNew=!1,r):storage[s.collectionName].add(t,void 0,!0)),i&&i(t,e,o),c.resolve(t,e,o)}).fail(function(t,e,o){c.reject(t,e,o)}),r.clearIdentity(s),c}o.postLikeRequest=n,o.createPostLikeRequest=function(e){return function(){var t=Array.prototype.slice.call(arguments);return n.apply(this,[e].concat(t))}}},{"./utils":6}],6:[function(t,e,o){"use strict";var u={},r=(Array.prototype,Object.prototype.toString);function n(t){return t&&"object"==typeof t||!1}u.isString=function(t){return"string"==typeof t||n(t)&&"[object String]"===r.call(t)||!1},u.isBoolean=function(t){return!0===t||!1===t||n(t)&&"[object Boolean]"===r.call(t)||!1},u.isObject=function(t){return t&&null!==t&&"object"==typeof t||!1},u.isFunction=function(t){return"function"==typeof t||!1},u.deepMerge=function o(r,e){var t=Array.isArray(e),n=t&&[]||{};if(t)r=r||[],n=n.concat(r),e.forEach(function(t,e){void 0===n[e]?n[e]=t:"object"==typeof t?n[e]=o(r[e],t):-1===r.indexOf(t)&&n.push(t)});else{if(r&&"object"==typeof r&&Object.keys(r).forEach(function(t){n[t]=r[t]}),null==e)return n;Object.keys(e).forEach(function(t){"object"==typeof e[t]&&e[t]&&r[t]?n[t]=o(r[t],e[t]):n[t]=e[t]})}return n},u.select=function(t){if(t){if(1!==arguments.length)throw new Error("Invalid select: select only takes 1 argument");var e={},o=typeof t;if("string"==o||"object"==o&&"number"==typeof t.length&&!Array.isArray(t)){"string"==o&&(t=t.split(/\s+/));for(var r=0,n=t.length;r<n;++r){var i=t[r];if(i){var a="-"===i[0]?0:1;0==a&&(i=i.substring(1)),e[i]=a}}return e}if(!u.isObject(t)||Array.isArray(t))throw new TypeError("Invalid select() argument. Must be string or object.");for(var s=Object.keys(t),c=0;c<s.length;++c)e[s[c]]=t[s[c]];return e}},u.clearIdentity=function(t){for(;t.parentResource;)t.identity="",t=t.parentResource},u.constructUrl=function t(e){var o=e.identity?"/"+e.identity:"/";return e.parentResource?t(e.parentResource)+"/"+e.url+o:e.url},e.exports=u},{}]},{},[3])(3)});