!function(t){if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else{var e;"undefined"!=typeof window?e=window:"undefined"!=typeof global?e=global:"undefined"!=typeof self&&(e=self),e.ApiClient=t()}}(function(){return function t(e,i,n){function r(s,a){if(!i[s]){if(!e[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=i[s]={exports:{}};e[s][0].call(u.exports,function(t){var i=e[s][1][t];return r(i?i:t)},u,u.exports,t,e,i,n)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)r(n[s]);return r}({1:[function(t,e){"use strict";var i={resourceName:"resource",url:"",add:function(t,e,i){if(i||(i=e||{},e=this),this[t])throw new TypeError("Ресурс с названием "+t+"уже есть.");if((i.schemaName||i.collectionName||i.storage)&&(i.collectionName=i.collectionName||t),this[t]=new o(t,e,i),i.collectionName&&!storage[i.collectionName]){var n=storage.schemas[i.schemaName];if(!n)throw new TypeError("Resource::"+t+" Нельзя использовать хранилище (создать коллекцию), не указав схему данных");storage.createCollection(i.collectionName,n,this[t])}return this[t]},transformFields:function(){var t=arguments[0];if(!t)return this;if(1!==arguments.length)throw new Error("Invalid select: select only takes 1 argument");var e=this._fields||(this._fields={}),i=typeof t;if("string"==i||"object"==i&&"number"==typeof t.length&&!Array.isArray(t)){"string"==i&&(t=t.split(/\s+/));for(var n=0,r=t.length;r>n;++n){var o=t[n];if(o){var s="-"==o[0]?0:1;0===s&&(o=o.substring(1)),e[o]=s}}return this}if(_.isObject(t)&&!Array.isArray(t)){for(var a=Object.keys(t),n=0;n<a.length;++n)e[a[n]]=t[a[n]];return this}throw new TypeError("Invalid select() argument. Must be string or object.")},constructUrl:function a(){var t=this.identity?"/"+this.identity:"";return this.parentResource?a.call(this.parentResource,!0)+"/"+this.url+t:this.url},_resourceRequest:function(t,e,i){var n=this.constructUrl(),r=this.notifications;return console.log(this.resourceName+"::"+t+" "+n),this.instance._request(t,n,e.data,e,r,i)}},n=[],r={create:"POST",read:"GET",update:"PUT","delete":"DELETE",patch:"PATCH",post:"POST",get:"GET",save:"PUT"};_.forEach(Object.keys(r),function(t){i[t]=function(e,i,r){var o,s=this,a=this.identity,c=this.instance.methodsMap[t];$.isFunction(e)&&(r=e,e=void 0),$.isFunction(i)&&(r=i,i=void 0),i=i||{},("POST"===c||"PUT"===c)&&(e instanceof storage.Document?(o=e._id.toString(),e=e.$__delta()):storage.ObjectId.isValid(a)?o=a:e._id&&storage.ObjectId.isValid(e._id)&&(o=e._id.toString())),i.data=e;var u={method:c,url:this.constructUrl(),ajaxSettings:i,result:null,meta:null};if("GET"===c){var l=_.find(n,u);if(s.storage&&a&&l&&l.result)return r&&r(l.result,l.meta),void(this.identity="")}var d=$.Deferred();return this._resourceRequest(t,i).done(function(t,a,l){var f,h;e&&e.fields&&(h=s.transformFields(e.fields)),s.storage&&!i.doNotStore?"POST"===c||"PUT"===c?(f=storage[s.collectionName].findById(o),f?(f.set(t.result),storage[s.collectionName].updateIdLink(f),f.isNew=!1):f=storage[s.collectionName].add(t.result||t,void 0,!0)):"GET"===c&&(f=h?t.result:storage[s.collectionName].add(t.result||t,h,!0)):f=t.result||t,u.result=f,u.meta=t.meta,n.push(u),r&&r(f,t.meta),d.resolve(f,t.meta,a,l)}).fail(function(t,e,i){d.reject(t,e,i)}),this.identity="",d}});var o=function(t,e,n){var r=function o(t){return t&&!_.isString(t)&&console.error("identity должен быть строкой, а не",t),o.identity=t||"",o};return $.extend(r,i,{resourceName:t,url:t},n),r.parentResource=e,r.instance=e.instance||e,r},s=function(t,e){return new s.instance.init(t,e)};s.instance=s.prototype={constructor:s,init:function(t,e){"string"==typeof t&&(e=e||{},e.url=t),this.notifications=!1,this.hooks={data:{},headers:{}},$.extend(!0,this,$.isPlainObject(t)?t:e)},add:i.add,methodsMap:r,_prepareAjaxSettings:function(t,e,i,n){var r=this.methodsMap[t],o=$.extend(!0,{},this.hooks,n,{type:r,url:e});return this.token&&n.headers&&null==n.headers.token&&(o.headers.Authorization="token "+this.token),"GET"===r?_.assign(o.data,i):(i&&i.constructor&&i.constructor.name&&"Document"===i.constructor.name?_.assign(o.data,i.toObject({depopulate:1})):i&&_.assign(o.data,i),o.data&&"application/json"===o.contentType&&(o.data=JSON.stringify(o.data))),$.isPlainObject(e)&&(console.info("Ах@*ть, нужный код!!!!"),o=e),o},_request:function(t,e,i,n,r,o){if(!_.isString(t))throw new Error("Параметр `method` должен быть строкой, а не ",t);var s=this,a=this.methodsMap[t],c="GET"===a?"load":"POST"===a||"PUT"===a||"PATCH"===a?"save":"delete",u=this._prepareAjaxSettings(t,e,i,n);return r=_.isBoolean(r)?r&&cf.notification:this.notifications&&cf.notification,r&&cf.notification[c].show(),$.ajax(u).fail(function(a,u,l){return console.warn(a,u,l),401===a.status&&s.unauthorizedCallback?(s.unauthorizedCallback(a,t,e,i,n,o),void(r&&cf.notification[c].hide())):void(r&&cf.notification[c].fail())}).done(function(){r&&cf.notification[c].hide()}).done(o)},read:function(t,e){return console.log("api::read"),$.isFunction(t)&&(e=t,t=void 0),t=t||{},this._request("read",this.url,void 0,t,!1,e)}},s.instance.init.prototype=s.instance,e.exports=s},{}]},{},[1])(1)});