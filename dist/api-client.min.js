!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.ApiClient=e()}}(function(){return function e(t,i,r){function n(s,a){if(!i[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=i[s]={exports:{}};t[s][0].call(u.exports,function(e){var i=t[s][1][e];return n(i?i:e)},u,u.exports,e,t,i,r)}return i[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(e,t){"use strict";function i(e){for(;e.parentResource;)e.identity="",e=e.parentResource}function r(e,t,i){var r=function n(e){return e&&!_.isString(e)&&console.error("identity должен быть строкой, а не",e),n.identity=e||"",n};return $.extend(r,o,{resourceName:e,url:e},i),r.parentResource=t,r.instance=t.instance||t,r}function n(e,t){return this instanceof n?(_.isObject(e)&&(t=e,e=location.origin),null==e&&(e=location.origin),t=t||{},t.url=e,this.notifications=!1,this.hooks={data:{},headers:{}},void $.extend(!0,this,t)):new n(e,t)}var o={resourceName:"resource",url:"",add:function(e,t,i){if(i||(i=t||{},t=this),this[e])throw new TypeError("The resource named "+e+"already exists.");if((i.schemaName||i.collectionName||i.storage)&&(i.collectionName=i.collectionName||e),this[e]=new r(e,t,i),i.collectionName&&!storage[i.collectionName]){var n=storage.schemas[i.schemaName];if(!n)throw new TypeError("Resource::"+e+" You cannot use storage (create collection), without specifying the schema of the data.");storage.createCollection(i.collectionName,n,this[e])}return this[e]},transformFields:function(){var e=arguments[0];if(!e)return this;if(1!==arguments.length)throw new Error("Invalid select: select only takes 1 argument");var t=this._fields||(this._fields={}),i=typeof e;if("string"==i||"object"==i&&"number"==typeof e.length&&!Array.isArray(e)){"string"==i&&(e=e.split(/\s+/));for(var r=0,n=e.length;n>r;++r){var o=e[r];if(o){var s="-"==o[0]?0:1;0===s&&(o=o.substring(1)),t[o]=s}}return this}if(_.isObject(e)&&!Array.isArray(e)){for(var a=Object.keys(e),r=0;r<a.length;++r)t[a[r]]=e[a[r]];return this}throw new TypeError("Invalid select() argument. Must be string or object.")},constructUrl:function c(){var e=this.identity?"/"+this.identity:"";return this.parentResource?c.call(this.parentResource,!0)+"/"+this.url+e:this.url},_resourceRequest:function(e,t,i){var r=this.constructUrl(),n=this.notifications;return console.log(this.resourceName+"::"+e+" "+r),this.instance._request(e,r,t.data,t,n,i)}},s=[],a={create:"POST",read:"GET",update:"PUT","delete":"DELETE",patch:"PATCH",post:"POST",get:"GET",save:"PUT"};_.forEach(Object.keys(a),function(e){o[e]=function(t,r,n){var o,a=this,c=this.identity,u=this.instance.methodsMap[e];$.isFunction(t)&&(n=t,t=void 0),$.isFunction(r)&&(n=r,r=void 0),r=r||{},("POST"===u||"PUT"===u)&&(t instanceof storage.Document?(o=t._id.toString(),t=t.$__delta()):storage.ObjectId.isValid(c)?o=c:t._id&&storage.ObjectId.isValid(t._id)&&(o=t._id.toString())),r.data=t;var l={method:u,url:this.constructUrl(),ajaxSettings:r,result:null,meta:null};if("GET"===u){var d=_.find(s,l);if(a.storage&&c&&d&&d.result)return n&&n(d.result,d.meta),void i(a)}var f=$.Deferred();return this._resourceRequest(e,r).done(function(e,i,c){var d,h;t&&t.fields&&(h=a.transformFields(t.fields)),a.storage&&!r.doNotStore?"POST"===u||"PUT"===u?(d=storage[a.collectionName].findById(o),d?(d.set(e.result),storage[a.collectionName].updateIdLink(d),d.isNew=!1):d=storage[a.collectionName].add(e.result||e,void 0,!0)):"GET"===u&&(d=h?e.result:storage[a.collectionName].add(e.result||e,h,!0)):d=e.result||e,l.result=d,l.meta=e.meta,s.push(l),n&&n(d,e.meta),f.resolve(d,e.meta,i,c)}).fail(function(e,t,i){f.reject(e,t,i)}),i(a),f}}),n.prototype={add:o.add,methodsMap:a,_prepareAjaxSettings:function(e,t,i,r){var n=this.methodsMap[e],o=$.extend(!0,{},this.hooks,r,{type:n,url:t});return this.token&&r.headers&&null==r.headers.token&&(o.headers.Authorization="token "+this.token),"GET"===n?_.assign(o.data,i):(i&&i.constructor&&i.constructor.name&&"Document"===i.constructor.name?_.assign(o.data,i.toObject({depopulate:1})):i&&_.assign(o.data,i),o.data&&"application/json"===o.contentType&&(o.data=JSON.stringify(o.data))),$.isPlainObject(t)&&(console.info("Ах@*ть, нужный код!!!!"),o=t),o},_request:function(e,t,i,r,n,o){if(!_.isString(e))throw new Error("Параметр `method` должен быть строкой, а не ",e);var s=this,a=this.methodsMap[e],c="GET"===a?"load":"POST"===a||"PUT"===a||"PATCH"===a?"save":"delete",u=this._prepareAjaxSettings(e,t,i,r);return n=_.isBoolean(n)?n&&cf.notification:this.notifications&&cf.notification,n&&cf.notification[c].show(),$.ajax(u).fail(function(a,u,l){return console.warn(a,u,l),401===a.status&&s.unauthorizedCallback?(s.unauthorizedCallback(a,e,t,i,r,o),void(n&&cf.notification[c].hide())):void(n&&cf.notification[c].fail())}).done(function(){n&&cf.notification[c].hide()}).done(o)},read:function(e,t){return console.log("api::read"),$.isFunction(e)&&(t=e,e=void 0),e=e||{},this._request("read",this.url,void 0,e,!1,t)}},t.exports=n},{}]},{},[1])(1)});